import{l as R,r as d,y as w,D as B,K as k,N as S,j as e,L as A,d as F,P as L,C as m,G as j,e as z,E,O as $,g as I,B as g,v as O,i as Q,w as q}from"./index-55mznCYq.js";const G=()=>{var h;const{isFarmer:a,isBuyer:f}=R(),[n,N]=d.useState(1),[i,x]=d.useState({crop_id:"",region_id:""}),[t,u]=d.useState(null),{data:r}=w(),{data:c}=B(),y=k({page:n,limit:10},{enabled:a}),b=S({...i,page:n,limit:10},{enabled:!a}),{data:l,isLoading:v}=a?y:b,C=(r==null?void 0:r.map(s=>({value:s.id,label:s.name})))||[],_=(c==null?void 0:c.map(s=>({value:s.id,label:s.name})))||[],p=(l==null?void 0:l.requests)||[],P=(l==null?void 0:l.totalPages)||1;return e.jsx(A,{children:e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:a?"Buyer Requests":"All Requests"}),e.jsx("p",{className:"text-neutral-500 mt-1",children:a?"Buyers looking for produce that matches your crops":"Browse produce requests from buyers"})]}),f&&e.jsxs(F,{to:"/create-request",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(L,{size:20}),"Post Request"]})]}),!a&&e.jsxs(m,{className:"flex flex-col md:flex-row gap-4",children:[e.jsx(j,{label:"Filter by Crop",value:i.crop_id,onChange:s=>x(o=>({...o,crop_id:s.target.value})),options:C,placeholder:"All Crops",className:"md:w-64"}),e.jsx(j,{label:"Filter by Region",value:i.region_id,onChange:s=>x(o=>({...o,region_id:s.target.value})),options:_,placeholder:"All Regions",className:"md:w-64"})]}),v?e.jsx(z,{}):p.length===0?e.jsx(E,{icon:$,title:"No requests found",description:a?"No buyer requests match your current listings. Create more listings to see relevant requests.":"No buyer requests available at the moment."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-4",children:p.map(s=>e.jsx(m,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.crop_name}),e.jsx(I,{status:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500",children:"Quantity"}),e.jsxs("p",{className:"font-medium",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500",children:"Max Price"}),e.jsx("p",{className:"font-medium",children:s.max_price?`P${s.max_price}/${s.unit}`:"Flexible"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500",children:"Region"}),e.jsx("p",{className:"font-medium",children:s.region_name||"Any"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500",children:"Buyer"}),e.jsx("p",{className:"font-medium",children:s.buyer_name})]})]}),s.notes&&e.jsxs("p",{className:"text-neutral-600 text-sm mt-3 italic",children:['"',s.notes,'"']})]}),a&&s.status==="open"&&e.jsxs(g,{variant:"outline",onClick:()=>u(s),children:[e.jsx(O,{size:18}),"Contact Buyer"]})]})},s.id))}),e.jsx(Q,{page:n,totalPages:P,onPageChange:N})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(m,{className:"w-full max-w-md",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",children:"Contact Buyer"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:t.buyer_name}),e.jsxs("p",{className:"text-neutral-500 text-sm",children:["Looking for ",t.quantity," ",t.unit," of ",t.crop_name]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-neutral-50 rounded-lg",children:[e.jsx(q,{size:20,className:"text-primary-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-500",children:"Phone Number"}),e.jsx("p",{className:"font-semibold",children:t.buyer_phone})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("a",{href:`tel:${t.buyer_phone}`,className:"btn-primary flex-1 text-center",children:"Call"}),e.jsx("a",{href:`https://wa.me/${(h=t.buyer_phone)==null?void 0:h.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary flex-1 text-center",children:"WhatsApp"})]}),e.jsx(g,{variant:"outline",onClick:()=>u(null),className:"w-full",children:"Close"})]})]})})]})})};export{G as default};

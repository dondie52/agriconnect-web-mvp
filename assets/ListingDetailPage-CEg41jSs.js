import{k as L,u as D,l as M,m as S,n as B,r as d,j as e,L as p,e as F,B as n,A as $,C as h,f as y,o as T,g as E,p as v,q as Q,s as U,t as W,U as b,v as J,M as C,I as R,T as Y,w as G,x as H,z as x}from"./index-55mznCYq.js";const V=()=>{var N;const{id:j}=L(),m=D(),{user:o,isBuyer:_}=M(),{data:s,isLoading:w}=S(j),f=B(),[k,i]=d.useState(!1),[q,u]=d.useState(!1),[r,c]=d.useState({quantity:"",delivery_preference:"pickup",notes:""}),[g,P]=d.useState(0);if(w)return e.jsx(p,{children:e.jsx(F,{})});if(!s)return e.jsx(p,{children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h2",{className:"text-xl font-semibold text-neutral-700",children:"Listing not found"}),e.jsx(n,{variant:"outline",onClick:()=>m("/listings"),className:"mt-4",children:"Back to Listings"})]})});let l=[];try{Array.isArray(s.images)?l=s.images:typeof s.images=="string"&&(l=JSON.parse(s.images))}catch{l=[]}const O=(o==null?void 0:o.id)===s.farmer_id,z=async()=>{var t,a;if(!r.quantity||r.quantity<=0){x.error("Please enter a valid quantity");return}if(parseFloat(r.quantity)>s.quantity){x.error("Quantity exceeds available stock");return}try{await f.mutateAsync({listing_id:parseInt(j),quantity:parseFloat(r.quantity),delivery_preference:r.delivery_preference,notes:r.notes}),x.success("Order placed successfully!"),i(!1),m("/my-orders")}catch(A){x.error(((a=(t=A.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to place order")}},I=async()=>{try{await H.trackContact(s.id),u(!0)}catch{u(!0)}};return e.jsx(p,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fadeIn",children:[e.jsxs("button",{onClick:()=>m(-1),className:"flex items-center gap-2 text-neutral-600 hover:text-neutral-800",children:[e.jsx($,{size:20}),"Back"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-square -m-6 mb-4",children:e.jsx(y,{src:l[g],alt:s.crop_name,className:"w-full h-full"})}),l.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:l.map((t,a)=>e.jsx("button",{onClick:()=>P(a),className:`w-16 h-16 flex-shrink-0 rounded-lg overflow-hidden border-2 ${a===g?"border-primary-500":"border-transparent"}`,children:e.jsx(y,{src:t,alt:`${s.crop_name} ${a+1}`,className:"w-full h-full"})},a))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx(T,{children:s.crop_category}),e.jsx("h1",{className:"text-2xl font-bold text-neutral-800 mt-2",children:s.crop_name})]}),e.jsx(E,{status:s.status})]}),e.jsxs("div",{className:"text-3xl font-bold text-primary-600 mb-4",children:["P",s.price,e.jsxs("span",{className:"text-lg text-neutral-400 font-normal",children:["/",s.unit]})]}),e.jsxs("div",{className:"space-y-3 text-neutral-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:18,className:"text-neutral-400"}),e.jsxs("span",{children:[s.quantity," ",s.unit," available"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:18,className:"text-neutral-400"}),e.jsx("span",{children:s.region_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{size:18,className:"text-neutral-400"}),e.jsxs("span",{children:["Listed ",W(new Date(s.created_at),{addSuffix:!0})]})]})]}),s.description&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Description"}),e.jsx("p",{className:"text-neutral-600",children:s.description})]})]}),e.jsxs(h,{children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Seller Information"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(b,{size:24,className:"text-primary-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.farmer_name}),e.jsx("p",{className:"text-sm text-neutral-500",children:s.region_name})]})]})]}),!O&&s.status==="active"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(n,{onClick:I,variant:"outline",className:"flex-1",children:[e.jsx(J,{size:18}),"Contact Farmer"]}),_&&e.jsxs(n,{onClick:()=>i(!0),className:"flex-1",children:[e.jsx(v,{size:18}),"Place Order"]})]})]})]}),e.jsx(C,{isOpen:k,onClose:()=>i(!1),title:"Place Order",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-neutral-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-neutral-600",children:"Item:"}),e.jsx("span",{className:"font-medium",children:s.crop_name})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-neutral-600",children:"Price:"}),e.jsxs("span",{className:"font-medium",children:["P",s.price,"/",s.unit]})]}),e.jsxs("div",{className:"flex justify-between mt-1",children:[e.jsx("span",{className:"text-neutral-600",children:"Available:"}),e.jsxs("span",{className:"font-medium",children:[s.quantity," ",s.unit]})]})]}),e.jsx(R,{label:"Quantity",type:"number",step:"0.1",min:"0.1",max:s.quantity,value:r.quantity,onChange:t=>c(a=>({...a,quantity:t.target.value})),placeholder:`Max ${s.quantity} ${s.unit}`}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Delivery Preference"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"delivery",value:"pickup",checked:r.delivery_preference==="pickup",onChange:t=>c(a=>({...a,delivery_preference:t.target.value}))}),e.jsx("span",{children:"Pickup"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"delivery",value:"delivery",checked:r.delivery_preference==="delivery",onChange:t=>c(a=>({...a,delivery_preference:t.target.value}))}),e.jsx("span",{children:"Delivery"})]})]})]}),e.jsx(Y,{label:"Notes (Optional)",value:r.notes,onChange:t=>c(a=>({...a,notes:t.target.value})),placeholder:"Any special requests or instructions...",rows:3}),r.quantity&&e.jsx("div",{className:"p-4 bg-primary-50 rounded-lg",children:e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-primary-600",children:["P",(parseFloat(r.quantity)*s.price).toFixed(2)]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(n,{variant:"outline",onClick:()=>i(!1),className:"flex-1",children:"Cancel"}),e.jsx(n,{onClick:z,loading:f.isPending,className:"flex-1",children:"Confirm Order"})]})]})}),e.jsx(C,{isOpen:q,onClose:()=>u(!1),title:"Contact Farmer",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center",children:e.jsx(b,{size:32,className:"text-primary-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.farmer_name}),e.jsx("p",{className:"text-neutral-500",children:s.region_name})]})]}),e.jsx("div",{className:"p-4 bg-neutral-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{size:20,className:"text-primary-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-neutral-500",children:"Phone Number"}),e.jsx("p",{className:"font-semibold",children:s.farmer_phone})]})]})}),e.jsx("p",{className:"text-sm text-neutral-500",children:"You can call or WhatsApp the farmer directly to discuss the produce, negotiate prices, or arrange for pickup/delivery."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("a",{href:`tel:${s.farmer_phone}`,className:"btn-primary flex-1 text-center",children:"Call"}),e.jsx("a",{href:`https://wa.me/${(N=s.farmer_phone)==null?void 0:N.replace(/\D/g,"")}`,target:"_blank",rel:"noopener noreferrer",className:"btn-secondary flex-1 text-center",children:"WhatsApp"})]})]})})]})})};export{V as default};

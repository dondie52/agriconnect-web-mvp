import{c as E,R as M,V as T,W as P,j as e,Y as N,Z as $,l as q,D,_ as u,r as K,$ as O,L as Q,q as U,e as _,C as g,a0 as B,a1 as G,a2 as v,a3 as Z,a4 as j,a5 as H,a6 as V,a7 as Y,a8 as J,a9 as X}from"./index-55mznCYq.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f=E("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),ee=({weather:s,forecast:l,location:t,cropType:c,enabled:r=!0}={})=>{const d=s?`${s.temperature}-${s.precipitationChance}-${Math.round(s.windspeed/5)*5}`:null;return M({queryKey:["ai-tips",t,d],queryFn:async()=>(await P.getFarmingTips({weather:s,forecast:l,location:t,cropType:c})).data,enabled:r&&!!s&&!!t,staleTime:1e3*60*15,gcTime:1e3*60*30,refetchOnWindowFocus:!1,retry:1})},se=()=>{const s=T();return()=>{s.invalidateQueries({queryKey:["ai-tips"]})}},te=()=>e.jsxs("div",{className:"space-y-3 animate-pulse",children:[[1,2,3,4].map(s=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 mt-2 rounded-full bg-yellow-300/60 shrink-0"}),e.jsx("div",{className:"flex-1 space-y-2",children:e.jsx("div",{className:"h-4 bg-yellow-300/40 rounded",style:{width:`${85-s*10}%`}})})]},s)),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx(f,{size:14,className:"text-yellow-500/50 animate-pulse"}),e.jsx("span",{className:"text-xs text-yellow-600/60",children:"Generating tips with AI..."})]})]}),ae=({onRetry:s})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-4 text-yellow-700",children:[e.jsx($,{size:24,className:"mb-2 text-yellow-600"}),e.jsx("p",{className:"text-sm mb-3",children:"Unable to generate tips right now"}),s&&e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-3 py-1.5 text-xs font-medium bg-yellow-200 hover:bg-yellow-300 rounded-lg transition-colors",children:[e.jsx(N,{size:14}),"Try Again"]})]}),le=({tips:s=[],isLoading:l=!1,isError:t=!1,source:c,onRetry:r})=>{const d=l&&s.length===0,x=t&&s.length===0,h=s.length>0,i=l&&s.length>0;return e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-5 transition-all duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-yellow-800 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸŒ¾"}),e.jsx("span",{children:"AI Farming Tips"}),c&&c!=="static"&&e.jsx(f,{size:16,className:"text-yellow-600"}),i&&e.jsx("span",{className:"text-xs font-normal text-yellow-600 animate-pulse",children:"updating..."})]}),r&&e.jsx("button",{onClick:r,disabled:l,className:"p-2 text-yellow-600 hover:text-yellow-800 hover:bg-yellow-100 rounded-lg transition-colors disabled:opacity-50",title:"Refresh tips",children:e.jsx(N,{size:16,className:l?"animate-spin":""})})]}),d&&e.jsx(te,{}),x&&e.jsx(ae,{onRetry:r}),h&&e.jsx("ul",{className:"space-y-2.5",children:s.map((p,a)=>e.jsxs("li",{className:"flex items-start gap-2 text-yellow-700 text-sm leading-relaxed animate-fadeIn",style:{animationDelay:`${a*100}ms`,animationFillMode:"both"},children:[e.jsx("span",{className:"text-yellow-500 mt-0.5 shrink-0",children:"â€¢"}),e.jsx("span",{children:p})]},a))}),h&&e.jsx("div",{className:"flex items-center gap-2 mt-4 pt-3 border-t border-yellow-200/50",children:c&&c!=="static"?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:12,className:"text-yellow-500"}),e.jsx("span",{className:"text-xs text-yellow-600",children:"Generated by AI â€¢ Personalized for your location and conditions"})]}):e.jsx("span",{className:"text-xs text-yellow-600",children:"Based on current weather conditions"})})]})},ie=(s,l=24)=>{const t={size:l,strokeWidth:1.5};return s<=1?e.jsx(H,{...t,className:"text-yellow-500"}):s<=3?e.jsx(j,{...t,className:"text-neutral-400"}):s>=45&&s<=48?e.jsx(V,{...t,className:"text-neutral-400"}):s>=51&&s<=67||s>=80&&s<=82?e.jsx(Y,{...t,className:"text-blue-500"}):s>=71&&s<=77||s>=85&&s<=86?e.jsx(J,{...t,className:"text-blue-300"}):s>=95?e.jsx(X,{...t,className:"text-purple-500"}):e.jsx(j,{...t,className:"text-neutral-400"})},ne=(s,l=!0)=>s<=1?l?"â˜€ï¸":"ðŸŒ™":s<=3?l?"â›…":"â˜ï¸":s>=45&&s<=48?"ðŸŒ«ï¸":s>=51&&s<=67||s>=80&&s<=82?"ðŸŒ§ï¸":s>=71&&s<=77||s>=85&&s<=86?"â„ï¸":s>=95?"â›ˆï¸":l?"ðŸŒ¤ï¸":"ðŸŒ™",C={latitude:-24.6282,longitude:25.9231},ce=()=>{var w;const s=T(),{user:l}=q(),{data:t,isLoading:c}=D(),[r,d]=u.useState(null),[x,h]=u.useState(!1),i=u.useMemo(()=>t!=null&&t.length?t.find(o=>o.id===r)||t[0]:null,[t,r]);K.useEffect(()=>{if(t!=null&&t.length&&!r){const n=l==null?void 0:l.region_id;n&&t.find(o=>o.id===n)?d(n):d(t[0].id)}},[t,l==null?void 0:l.region_id,r]);const p=u.useMemo(()=>i!=null&&i.latitude&&(i!=null&&i.longitude)?{lat:parseFloat(i.latitude),lon:parseFloat(i.longitude)}:{lat:C.latitude,lon:C.longitude},[i]),{data:a,isLoading:k,isFetching:y,refetch:z}=O({lat:p.lat,lon:p.lon,enabled:!!i}),{data:m,isLoading:F,isFetching:L,isError:S}=ee({weather:a?{temperature:a.temperature,highTemp:a.highTemp,lowTemp:a.lowTemp,description:a.description,windspeed:a.windspeed,precipitationChance:a.precipitationChance}:null,forecast:a==null?void 0:a.dailyForecast,location:i==null?void 0:i.name,enabled:!!a&&!!i}),R=se(),A=()=>R(),b=async()=>{h(!0),await s.invalidateQueries({queryKey:["weather"]}),await z(),setTimeout(()=>h(!1),500)},I=n=>{d(parseInt(n.target.value))},W=c||k&&!a;return e.jsx(Q,{children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"page-title",children:"Weather Forecast"}),e.jsx("p",{className:"text-neutral-500 mt-1",children:"Plan your farming activities based on weather conditions"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(U,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-neutral-400"}),e.jsx("select",{value:r||"",onChange:I,className:"select-field md:w-64 pl-9",disabled:c,children:c?e.jsx("option",{children:"Loading regions..."}):t==null?void 0:t.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})]}),e.jsx("button",{onClick:b,disabled:x||y,className:"p-3 rounded-lg bg-white shadow-sm hover:bg-neutral-50 transition-colors disabled:opacity-50",title:"Refresh weather",children:e.jsx(N,{size:20,className:`text-neutral-500 ${x||y?"animate-spin":""}`})})]})]}),W?e.jsx(_,{}):a&&i?e.jsxs(e.Fragment,{children:[e.jsxs(g,{className:"bg-gradient-to-br from-primary-500 to-primary-700 text-white",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-primary-100",children:[i.name,", Botswana"]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:"text-6xl",children:ne(a.weatherCode,a.isDay)}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-5xl font-bold",children:[a.temperature,"Â°C"]}),e.jsx("p",{className:"capitalize text-primary-100",children:a.description})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-center gap-1 mb-2",children:[e.jsx(B,{size:20,className:"text-red-300"}),e.jsx(G,{size:20,className:"text-blue-300"})]}),e.jsx("p",{className:"text-sm text-primary-100",children:"High / Low"}),e.jsxs("p",{className:"font-bold",children:[a.highTemp,"Â° / ",a.lowTemp,"Â°"]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsx(v,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-primary-100",children:"Rain Chance"}),e.jsxs("p",{className:"font-bold",children:[a.precipitationChance,"%"]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsx(Z,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-primary-100",children:"Wind Speed"}),e.jsxs("p",{className:"font-bold",children:[a.windspeed," km/h"]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsx(j,{size:24,className:"mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-primary-100",children:"Conditions"}),e.jsx("p",{className:"font-bold text-sm",children:a.isDay?"Daytime":"Nighttime"})]})]})]}),e.jsx("p",{className:"text-xs text-primary-200 mt-4",children:"Data from Open-Meteo â€¢ Auto-refreshes every 10 min"})]}),e.jsxs(g,{children:[e.jsx("h3",{className:"section-title mb-4",children:"7-Day Forecast"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-3",children:(w=a.dailyForecast)==null?void 0:w.slice(0,7).map((n,o)=>e.jsxs("div",{className:`rounded-lg p-4 text-center ${o===0?"bg-primary-50 border-2 border-primary-200":"bg-neutral-50"}`,children:[e.jsx("p",{className:"text-sm text-neutral-500 font-medium",children:o===0?"Today":new Date(n.date).toLocaleDateString("en-US",{weekday:"short"})}),e.jsx("div",{className:"my-2 flex justify-center",children:ie(n.weatherCode,32)}),e.jsxs("p",{className:"font-bold text-neutral-800",children:[n.highTemp,"Â°"]}),e.jsxs("p",{className:"text-neutral-400 text-sm",children:[n.lowTemp,"Â°"]}),n.precipitationChance>0&&e.jsxs("div",{className:"flex items-center justify-center gap-1 text-blue-500 text-xs mt-1",children:[e.jsx(v,{size:12}),e.jsxs("span",{children:[n.precipitationChance,"%"]})]})]},o))})]}),e.jsx(le,{tips:(m==null?void 0:m.tips)||[],isLoading:F||L,isError:S,source:m==null?void 0:m.source,onRetry:A})]}):e.jsxs(g,{className:"text-center py-12",children:[e.jsx(j,{size:48,className:"mx-auto text-neutral-300 mb-4"}),e.jsx("p",{className:"text-neutral-500",children:t!=null&&t.length?"Unable to load weather data. Please try again.":"No regions available. Please contact an administrator."}),e.jsx("button",{onClick:b,className:"btn-primary mt-4",children:"Retry"})]})]})})};export{ce as default};
